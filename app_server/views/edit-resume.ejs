<!DOCTYPE html>
<html lang="en">


<%- include partial/head.ejs %>

<body>

<%- include partial/nav.ejs %>

<div class="jumbotron">
    <div class="container">
        <form class="container" id="resume" action="" method="post">
            <h2 class="form-resume-heading">Edit the resume</h2>
            <hr>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label>First name</label>
                    <input type="text" name="firstName" class="form-control" id="firstName" placeholder="" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>Last name</label>
                    <input type="text" name="lastName" class="form-control" id="lastName" placeholder="" required>
                </div>

            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label>Gender</label>
                    <select name="gender" id="gender" class="form-control custom-select">
                        <!--<option selected>Please select</option>-->
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label>Date of Birth</label>
                    <input type="text" name="birth" class="form-control" id="birth" placeholder="" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label>Nationality</label>
                    <input type="text" name="country" class="form-control" id="country" placeholder="" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>State</label>
                    <input type="text" name="state" class="form-control" id="state" placeholder="" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>City</label>
                    <input type="text" name="city" class="form-control" id="city" placeholder="" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>Suburb</label>
                    <input type="text" name="suburb" class="form-control" id="suburb" placeholder="" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Address 1</label>
                    <input type="text" name="addr1" class="form-control" id="addr1" placeholder="" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label>Address 2</label>
                    <input type="text" name="addr2" class="form-control" id="addr2" placeholder="" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label>Email Address</label>
                    <input type="text" name="email" class="form-control" id="email" placeholder="" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>Phone Number</label>
                    <input type="text" name="phoneNumber" class="form-control" id="phoneNumber" placeholder="" required>
                </div>
            </div>

            <br>
            <hr>
            <h4>Desired job</h4>
            <br>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Desired Position</label>
                    <input type="text" name="desiredPosition" class="form-control" id="desiredPosition" placeholder="">
                </div>
            </div>

            <div class="row">
                <div class="col-md-2 mb-3">
                    <label>Desired Salary</label>
                    <input type="text" name="desiredSalary" class="form-control" id="desiredSalary" placeholder="">
                </div>
            </div>

            <br>
            <hr>
            <h4>Work places</h4>
            <br>
            <div class="row">
                <div class="col-md-2 mb-3">
                    <label>Start of work</label>
                    <input type="text" name="startWork" class="form-control" id="startWork" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-2 mb-3">
                    <label>End of work</label>
                    <input type="text" name="endWork" class="form-control" id="endWork" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Organization</label>
                    <input type="text" name="workPlace" class="form-control" id="workPlace" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Position</label>
                    <input type="text" name="workPosition" class="form-control" id="workPosition" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Responsibilities, tasks, achievements</label>
                    <textarea type="text" name="workAchievement" class="form-control" id="workAchievement" placeholder=""></textarea>
                </div>
            </div>


            <br>
            <hr>
            <h4>Education</h4>
            <br>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Name of educational institution</label>
                    <input type="text" name="eduInstitution" class="form-control" id="eduInstitution" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Department</label>
                    <input type="text" name="eduDepartment" class="form-control" id="eduDepartment" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Specialization</label>
                    <input type="text" name="eduSpecialization" class="form-control" id="eduSpecialization" placeholder="">
                </div>
            </div>
            <div class="row">
                <div class="col-md-2 mb-3">
                    <label>Year of graduation</label>
                    <input type="text" name="eduGraduation" class="form-control" id="eduGraduation" placeholder="">
                </div>
            </div>


            <hr>
            <button class="btn btn-primary" type="submit">Save</button>
        </form>

        <!--<script>-->
        <!--//Disabling form submissions if there are invalid fields-->
        <!--(function() {-->
        <!--"use strict";-->
        <!--window.addEventListener("load", function() {-->
        <!--var form = document.getElementById("needs-validation");-->
        <!--form.addEventListener("submit", function(event) {-->
        <!--if (form.checkValidity() == false) {-->
        <!--event.preventDefault();-->
        <!--event.stopPropagation();-->
        <!--}-->
        <!--form.classList.add("was-validated");-->
        <!--}, false);-->
        <!--}, false);-->
        <!--}());-->
        <!--</script>-->
    </div>
</div>

<%- include partial/footer.ejs %>

<%- include partial/shared-js.ejs %>

<script>
    'use strict';
    $(document).ready(function() {
        var resumeId = <%-JSON.stringify(resumeid)%>;
        if (resumeId != ""){
            $.ajax({
                url: "http://localhost:3000/api/resumes/" + resumeId,
                type: 'GET',
                beforeSend : function(xhr) {
                    // set JWT header
                    xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem('token'));
                },
                success: function (data) {
                    $('#firstName').val(data.firstName);
                    $('#lastName').val(data.lastName);
                    $('#gender').val(data.gender);
                    $('#birth').val(data.birth);
                    $('#country').val(data.country);
                    $('#state').val(data.state);
                    $('#city').val(data.city);
                    $('#suburb').val(data.suburb);
                    $('#addr1').val(data.addr1);
                    $('#addr2').val(data.addr2);
                    $('#email').val(data.email);
                    $('#phoneNumber').val(data.phoneNumber);
                    $('#desiredPosition').val(data.desiredPosition);
                    $('#desiredSalary').val(data.desiredSalary);
                    $('#startWork').val(data.startWork);
                    $('#endWork').val(data.endWork);
                    $('#workPlace').val(data.workPlace);
                    $('#workPosition').val(data.workPosition);
                    $('#workAchievement').val(data.workAchievement);
                    $('#eduInstitution').val(data.eduInstitution);
                    $('#eduDepartment').val(data.eduDepartment);
                    $('#eduSpecialization').val(data.eduSpecialization);
                    $('#eduGraduation').val(data.eduGraduation);
                },
                error: function (data) {
                    alert("Error.")
                }
            });

            $('form').submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: 'PUT',
                    beforeSend : function(xhr) {
                        // set JWT header

                        xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem('token'));

                    },
                    data: {
                        firstName: $('#firstName').val(),
                        lastName: $('#lastName').val(),
                        gender: $('#gender').val(),
                        birth: $('#birth').val(),
                        country: $('#country').val(),
                        state: $('#state').val(),
                        city: $('#city').val(),
                        suburb: $('#suburb').val(),
                        addr1: $('#addr1').val(),
                        addr2: $('#addr2').val(),
                        email: $('#email').val(),
                        phoneNumber: $('#phoneNumber').val(),
                        desiredPosition: $('#desiredPosition').val(),
                        desiredSalary: $('#desiredSalary').val(),
                        startWork: $('#startWork').val(),
                        endWork: $('#endWork').val(),
                        workPlace: $('#workPlace').val(),
                        workPosition: $('#workPosition').val(),
                        workAchievement: $('#workAchievement').val(),
                        eduInstitution: $('#eduInstitution').val(),
                        eduDepartment: $('#eduDepartment').val(),
                        eduSpecialization: $('#eduSpecialization').val(),
                        eduGraduation: $('#eduGraduation').val()
                    },

//                data: $("#resume").serialize(),

                    url: '/api/resumes/' + resumeId,
                    success: function (data) {
                        window.location = "/mod-resume-success";
                    },
                    error: function (data) {
                        alert("Edit resume failed.");
                    }
                });
            });
        } else {
            alert("resumeid is missing.");
        }
    });
</script>


</body>
</html>